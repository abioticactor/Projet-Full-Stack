@page "/pokedex"
@using System.Net.Http.Json
@using System.Text.Json.Serialization
@inject HttpClient Http
@inject Microsoft.Extensions.Logging.ILogger<Projet_FullStack_FrontEnd.Components.Pages.Pokedex> Logger

<h2>Pokédex</h2>

@if (pokemons is null || pokemons.Length == 0)
    {
        <p><em>Aucun pokémon disponible.</em></p>
    }
else
    {
        <div class="pokedex-grid">
            @{ var list = pokemons ?? Array.Empty<Pokemon>(); }
            @foreach (var pokemon in list)
            {
                <div class="pokemon-card">
                    <img src="@(pokemon?.sprites?.frontDefault ?? string.Empty)" alt="@(pokemon?.nameFr ?? string.Empty)" />
                    <h3>#@((pokemon?.numericId).GetValueOrDefault().ToString("D3")) - @(pokemon?.nameFr ?? "—")</h3>
                    <div class="types">
                        @foreach (var type in (pokemon?.types ?? Array.Empty<TypeEntry>()))
                        {
                            var display = type?.name ?? type?.nameFr ?? type?.name_fr ?? type?.nameEn ?? type?.name_en ?? string.Empty;
                            var cssRaw = type?.nameEn ?? type?.name_en ?? type?.name ?? string.Empty;
                            var css = cssRaw.ToLowerInvariant().Replace(' ', '-');
                            <span class="type @css">@display</span>
                        }
                    </div>
                </div>
            }
        </div>
    }

@code {
    private Pokemon[]? pokemons;
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        errorMessage = null;
        try
        {
            // Appel vers l'API backend (Http.BaseAddress doit pointer vers l'API)
            pokemons = await Http.GetFromJsonAsync<Pokemon[]>("api/pokemon");
            if (pokemons == null)
            {
                errorMessage = "Aucune donnée reçue du serveur.";
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Erreur lors de la récupération des pokémons");
            errorMessage = ex.Message;
        }
        finally
        {
            isLoading = false;
        }
    }

    private class Pokemon
    {
        public string? id { get; set; }
        public int? numericId { get; set; }
        public string? nameFr { get; set; }
        public Sprites? sprites { get; set; }
        public TypeEntry[]? types { get; set; }
        public string? description { get; set; }
    }

    private class Sprites
    {
        public string? frontDefault { get; set; }
        public string? frontShiny { get; set; }
    }

    private class TypeEntry
    {
        [JsonPropertyName("name")]
        public string? name { get; set; }

        [JsonPropertyName("nameEn")]
        public string? nameEn { get; set; }

        [JsonPropertyName("name_en")]
        public string? name_en { get; set; }

        [JsonPropertyName("nameFr")]
        public string? nameFr { get; set; }

        [JsonPropertyName("name_fr")]
        public string? name_fr { get; set; }

        public int slot { get; set; }
    }
}

<style>
    .pokedex-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        padding: 1rem;
    }

    .pokemon-card {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .pokemon-card:hover {
        transform: translateY(-5px);
    }

    .pokemon-card img {
        max-width: 120px;
        height: auto;
    }

    .types {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        margin-top: 0.5rem;
    }

    .type {
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.875rem;
        color: white;
    }

    /* Types de Pokémon */
    .normal { background-color: #A8A878; }
    .fire { background-color: #F08030; }
    .water { background-color: #6890F0; }
    .electric { background-color: #F8D030; }
    .grass { background-color: #78C850; }
    .ice { background-color: #98D8D8; }
    .fighting { background-color: #C03028; }
    .poison { background-color: #A040A0; }
    .ground { background-color: #E0C068; }
    .flying { background-color: #A890F0; }
    .psychic { background-color: #F85888; }
    .bug { background-color: #A8B820; }
    .rock { background-color: #B8A038; }
    .ghost { background-color: #705898; }
    .dragon { background-color: #7038F8; }
    .dark { background-color: #705848; }
    .steel { background-color: #B8B8D0; }
    .fairy { background-color: #EE99AC; }
</style>
